# 設計書：イニング加算ロジックの修正

## 1. 現状の構造と問題点

### 現状の処理フロー

1. `recordAtBatResult` (js/logic/game.js) が呼び出される。
2. `groundout` 等の場合：
   - `recordOut(state)` を呼び出す（アウト数 +1）。
   - `addOut(state)` を呼び出す（内部で `recordOut` を呼ぶため、アウト数 +1）。
   - 結果として、合計 2 アウト加算される。
3. `dp`（併殺）の場合：
   - `recordOut(state)` を呼び出す（アウト数 +1）。
   - `addOut(state)` を呼び出す（アウト数 +1）。
   - `addOut(state)` をさらに呼び出す（アウト数 +1）。
   - 結果として、合計 3 アウト加算される。

## 2. 修正方針

- `recordAtBatResult` 内での `recordOut(state)` の個別呼び出し（259行目〜260行目付近）が冗長であるため削除する。
- アウトの加算は `addOut(state)` に一元化する。

## 3. 修正詳細

### ファイル: `js/logic/game.js`

#### 修正前 (258行目付近)

```javascript
    // その他のアウト (犠打、犠飛含む)
    else if (['groundout', 'flyout', 'lineout', 'dp', 'sacrifice', 'sac_fly'].includes(resultCode)) {
        recordOut(state);
        if (resultCode === 'dp') {
             // 併殺はアウト2つ
             addOut(state);
             isChange = addOut(state);
        } else {
             isChange = addOut(state);
        }
    }
```

#### 修正後

```javascript
    // その他のアウト (犠打、犠飛含む)
    else if (['groundout', 'flyout', 'lineout', 'dp', 'sacrifice', 'sac_fly'].includes(resultCode)) {
        if (resultCode === 'dp') {
             // 併殺はアウト2つ
             addOut(state);
             isChange = addOut(state);
        } else {
             isChange = addOut(state);
        }
    }
```

※ `recordOut(state);` を削除。
