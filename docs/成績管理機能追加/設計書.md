# 設計書：成績管理機能システム

## 1. アーキテクチャ

```mermaid
graph LR
    User[管理者] -- ブラウザ --> Frontend[admin-db.html]
    Frontend -- REST API (Port 5000) --> Backend[Python Backend (Docker)]
    Backend -- TCP/IP (Port 3306) --> DB[(MySQL Interface)]
```

## 2. API設計 (Python Backend)

ベースURL: `http://localhost:5000/api`

| メソッド | エンドポイント         | 説明            | パラメータ/ボディ                                  |
| -------- | ---------------------- | --------------- | -------------------------------------------------- |
| POST     | `/import/csv`          | CSVインポート   | `file`: CSVファイル, `type`: 'batting'\|'pitching' |
| GET      | `/export/csv`          | CSVエクスポート | `type`: 'batting'\|'pitching'                      |
| GET      | `/stats/batting`       | 打撃成績取得    | `season` (opt), `team_id` (opt)                    |
| GET      | `/stats/pitching`      | 投手成績取得    | `season` (opt), `team_id` (opt)                    |
| PUT      | `/stats/batting/{id}`  | 打撃成績更新    | JSON (更新データ)                                  |
| PUT      | `/stats/pitching/{id}` | 投手成績更新    | JSON (更新データ)                                  |
| DELETE   | `/stats/batting/{id}`  | 打撃成績削除    | -                                                  |
| DELETE   | `/stats/pitching/{id}` | 投手成績削除    | -                                                  |

## 3. データベース設計

既存のスキーマを利用するが、`NULL` 許容を確認・変更する。

### 3.1 `batting_stats` (打撃成績)

- `id` (PK, AI)
- `player_id` (FK)
- `season` (Year)
- `games` (試合数)
- `batting_average` (打率)
- ... (その他主要スタッツ)
- **変更点**: 数値型カラムを `DEFAULT NULL` または アプリケーション側で `NaN` を `NULL` に変換して保存。

### 3.2 `pitching_stats` (投手成績)

- `id` (PK, AI)
- `player_id` (FK)
- `season` (Year)
- ... (その他主要スタッツ)

## 4. ディレクトリ構成

```
BaseballLive/
├── docs/
│   └── 成績管理機能追加/ ...
├── server/
│   └── python-backend/
│       ├── app.py          # エントリーポイント
│       ├── requirements.txt
│       ├── Dockerfile
│       ├── docker-compose.yml
│       ├── database.py     # DB接続モジュール
│       └── models.py       # データモデル
└── admin-db.html           # 修正対象
```

## 5. 実装手順

1. **Docker環境構築**: `server/python-backend` にPython環境を用意。
2. **バックエンド実装**:
   - DB接続確認。
   - CSV読み込み (Pandas使用)。
   - `null` データ処理ロジック実装。
   - APIエンドポイント作成。
3. **フロントエンド実装**:
   - `admin-db.html` にタブ追加。
   - JavaScriptでのファイルアップロード処理。
   - グリッド表示 (既存のテーブルスタイル流用)。

## 6. Docker設定詳細

- pythonイメージ: `python:3.9-slim`
- 依存ライブラリ: `flask`, `flask-cors`, `pandas`, `mysql-connector-python`, `python-dotenv`
- ネットワーク: ホストのMySQLに接続するため `host.docker.internal` を利用 (Windows/Mac)。
