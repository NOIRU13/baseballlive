# 要件定義書：成績管理機能およびPythonバックエンド

## 1. 目的

`admin-db.html` に成績管理機能を追加し、成績データの管理（CRUD）およびCSVインポート・エクスポートを可能にする。これらはPythonとDockerを使用した新しいバックエンドシステムによって提供される。

## 2. システム構成

- **フロントエンド**: 既存の `admin-db.html` を拡張
- **バックエンド**: Python (Flask または FastAPI) / Docker
- **データベース**: MySQL (既存のデータベース `baseball_live` を使用)

## 3. 機能要件

### 3.1 成績管理バックエンド (Python)

- **技術スタック**:
  - Python 3.9+
  - Webフレームワーク: Flask または FastAPI
  - データ処理: Pandas
  - DB接続: SQLAlchemy / MySQL Connector
- **API機能**:
  1. **CSVインポート**:
     - 選手、打撃成績、投手成績のCSVファイルをアップロードし、データベースに保存する。
     - データが `null` (欠損) の場合でもエラーとならず、`NULL` またはデフォルト値として取り込む。
     - 既存データがある場合は更新（Upsert）。
  2. **CSVエクスポート**:
     - データベース内の成績データをCSV形式でダウンロードする。
  3. **成績データ管理 (CRUD)**:
     - データの取得、追加、更新、削除。
- **Docker環境**:
  - `Dockerfile` および `docker-compose.yml` を作成。
  - ホストマシンのデータベース（または既存のMySQLコンテナ）に接続可能にする。

### 3.2 フロントエンド (admin-db.html)

- **タブ追加**: 「成績管理」タブを追加。
- **機能**:
  - CSVアップロードフォーム（ドラッグ＆ドロップ対応推奨）。
  - CSVダウンロードボタン。
  - 成績データの一覧表示（ページネーション、フィルタリング）。
  - 各レコードの編集・削除ボタン。

## 4. データ要件 (MySQL)

- **データベース名**: `baseball_live`
- **対象テーブル**:
  - `batting_stats`: 打撃成績
  - `pitching_stats`: 投手成績
  - `players`: 選手情報（参照のみ、またはインポート対象）
- **制約**:
  - 各カラムは `NULL` を許容する設計とする（またはアプリ側でよしなにハンドリング）。

## 5. 非機能要件

- エラーハンドリング: CSVフォーマット不正やDB接続エラー時に適切なメッセージを返す。
- パフォーマンス: 数百件程度のレコードを一括処理してもタイムアウトしないこと。
